<h4>Unstaged files</h4>

<p-divider type="solid"/>

@let workingDirFilesChanges = commitFilesChangesService.workingDirChanges$ | async;

@if (workingDirFilesChanges) {
    <p-listbox @slightSlideIn [options]="workingDirFilesChanges.unstaged" optionLabel="path" (onChange)="fileDiffPanelService.showWorkingDirDiffs($event.value)" [scrollHeight]="undefined">
        <ng-template #item let-workingDirFileChanges>
            @let fileChanges = $WorkDirFileChanges(workingDirFileChanges);
            <i class="text-gray mr-2 fa {{ FileStatusesIcons[fileChanges.status.kind].icon }}"
               [style.color]="FileStatusesIcons[fileChanges.status.kind].color"
               [style.filter]="'drop-shadow(0 0 5px ' + FileStatusesIcons[fileChanges.status.kind].color + ')'"></i>
            @let dir = directory(fileChanges.path);
            @if (dir.length) {
                <span class="ellipsis text-gray" [style.min-width.rem]="1.3">{{ dir }}</span>
            }
            <span class="white-space-nowrap">{{ (dir?.length ? '/' : '') + fileName(fileChanges.path) }}</span>
        </ng-template>
    </p-listbox>
}

<h4>Staged files</h4>

<p-divider type="solid"/>

@if (workingDirFilesChanges) {
    <p-listbox @slightSlideIn [options]="workingDirFilesChanges.staged" optionLabel="path" (onChange)="fileDiffPanelService.showWorkingDirDiffs($event.value)" [scrollHeight]="undefined">
        <ng-template #item let-workingDirFileChanges>
            @let fileChanges = $WorkDirFileChanges(workingDirFileChanges);
            <i class="text-gray mr-2 fa {{ FileStatusesIcons[fileChanges.status.kind].icon }}"
               [style.color]="FileStatusesIcons[fileChanges.status.kind].color"
               [style.filter]="'drop-shadow(0 0 5px ' + FileStatusesIcons[fileChanges.status.kind].color + ')'"></i>
            @let dir = directory(fileChanges.path);
            @if (dir.length) {
                <span class="ellipsis text-gray" [style.min-width.rem]="1.3">{{ dir }}</span>
            }
            <span class="white-space-nowrap">{{ (dir?.length ? '/' : '') + fileName(fileChanges.path) }}</span>
        </ng-template>
    </p-listbox>
}

<div class="p-2">
    Commit message
</div>
<form class="flex-column flex-1" [formGroup]="commitForm">

    <input pInputText placeholder="Summary" class="w-full commit-summary" formControlName="summary"/>

    <textarea pTextarea placeholder="Description" rows="3" class="flex-1 commit-description" formControlName="description"></textarea>

    <button pButton [disabled]="!commitForm.value.summary?.length" class="mt-2 border-round-xs">
        Stage files / changes to commit
    </button>

</form>